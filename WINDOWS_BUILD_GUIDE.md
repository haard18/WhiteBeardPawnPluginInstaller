# 🪟 Building on Windows VPS - Complete Guide

## 📋 Overview

You're on Mac developing → Need to build on Windows VPS → Create .msi installer

## 🎯 Quick Answer

**YES, just copy the entire project to Windows and run `build.bat`!**

But first, make sure you have the right files ready.

---

## 📦 STEP 1: Prepare Files on Mac (Before Transfer)

### ✅ Files You MUST Replace (Placeholders → Real Files)

```bash
cd /Users/hardy/Developer/Goldpesa/WhiteBeardPawnPluginInstaller
```

Replace these placeholders with your actual files:

1. **Plugin DLL:**
   ```bash
   # Replace: Files/PawnPlugin64.dll
   # With your actual compiled 64-bit plugin
   cp /path/to/your/actual/PawnPlugin64.dll Files/
   ```

2. **License Agreement PDF:**
   ```bash
   # Replace: Files/LicenseAgreement.pdf
   # With your actual EULA document
   cp /path/to/your/LicenseAgreement.pdf Files/
   ```

3. **User Guide PDF:**
   ```bash
   # Replace: Files/PawnPlugin_UserGuide.pdf
   # With your actual user guide
   cp /path/to/your/UserGuide.pdf Files/
   ```

4. **Icon File:**
   ```bash
   # Replace: icon.ico
   # With your actual Windows icon file (256x256 recommended)
   cp /path/to/your/icon.ico .
   ```

### ✅ Files That Are Already Ready

- ✅ `PublicKey.xml` - Already generated by LicenseGenerator
- ✅ All `.wxs` files - WiX source files
- ✅ All `.cs` files - Custom Actions source
- ✅ `build.bat` - Build script

### ⚠️ Files You Should NOT Copy

- ❌ `LicenseGenerator/PrivateKey.xml` - Keep this SECRET on your Mac!
- ❌ `LicenseGenerator/bin/` and `LicenseGenerator/obj/` - Build artifacts
- ❌ `.git/` folder - Not needed for building
- ❌ `*.lic` license files - Not needed in installer (customers bring their own)

---

## 📤 STEP 2: Transfer Project to Windows VPS

### Option A: Using Git (Recommended)

```bash
# On Mac - commit and push (PrivateKey.xml is already in .gitignore)
cd /Users/hardy/Developer/Goldpesa/WhiteBeardPawnPluginInstaller
git add .
git commit -m "Ready for Windows build"
git push

# On Windows - clone
git clone <your-repo-url> WhiteBeardPawnPluginInstaller
cd WhiteBeardPawnPluginInstaller
```

### Option B: Using SCP (Direct Transfer)

```bash
# On Mac - compress and upload
cd /Users/hardy/Developer/Goldpesa
tar -czf WhiteBeardPawnPluginInstaller.tar.gz \
    --exclude='.git' \
    --exclude='LicenseGenerator/bin' \
    --exclude='LicenseGenerator/obj' \
    --exclude='LicenseGenerator/PrivateKey.xml' \
    --exclude='CustomActions/bin' \
    --exclude='CustomActions/obj' \
    --exclude='*.lic' \
    WhiteBeardPawnPluginInstaller/

# Upload to Windows VPS
scp WhiteBeardPawnPluginInstaller.tar.gz user@your-windows-vps:/path/to/destination/
```

### Option C: Using FTP/SFTP Client

Use FileZilla, WinSCP, or similar:
1. Connect to your Windows VPS
2. Upload the entire `WhiteBeardPawnPluginInstaller` folder
3. Exclude: `.git`, `bin`, `obj`, `PrivateKey.xml`, `*.lic` files

### Option D: Using Cloud Storage (Easiest)

```bash
# On Mac
cd /Users/hardy/Developer/Goldpesa
zip -r WhiteBeardPawnPluginInstaller.zip WhiteBeardPawnPluginInstaller \
    -x "*.git*" \
    -x "*PrivateKey.xml" \
    -x "*.lic" \
    -x "*/bin/*" \
    -x "*/obj/*"

# Upload to Dropbox/Google Drive/OneDrive
# Download on Windows VPS
# Extract the zip
```

---

## 🪟 STEP 3: Setup Windows VPS

Connect to your Windows VPS (RDP or SSH) and install prerequisites:

### A. Install .NET SDK

1. Download from: https://dotnet.microsoft.com/download
2. Install .NET 6.0 SDK (or later)
3. Install .NET Framework 4.8 Developer Pack

Verify:
```cmd
dotnet --version
```

### B. Install WiX Toolset v4

1. Download from: https://wixtoolset.org/
2. Install WiX Toolset v4.x
3. Restart your terminal/command prompt

Verify:
```cmd
wix --version
```

Should show: `wix version 4.x.x`

### C. (Optional) Install Visual Studio

Only if you want IDE support:
- Download Visual Studio 2022 Community (free)
- Install with ".NET desktop development" workload
- Install "WiX Toolset Visual Studio Extension"

---

## 🚀 STEP 4: Build the Installer

Open Command Prompt or PowerShell on Windows VPS:

```cmd
cd C:\path\to\WhiteBeardPawnPluginInstaller
```

### Option A: Easy Way - Use build.bat

```cmd
build.bat
```

That's it! The script will:
1. ✅ Build CustomActions.dll
2. ✅ Compile WiX source files
3. ✅ Create WhiteBeardPawnPlugin.msi

### Option B: Manual Step-by-Step

If you want to do it manually:

```cmd
REM Step 1: Build Custom Actions
cd CustomActions
dotnet restore
dotnet build -c Release
cd ..

REM Step 2: Compile WiX source
wix build Product.wxs UI\VerifyLicenseDialog.wxs UI\TermsDialog.wxs UI\MT5PathDialog.wxs ^
    -ext WixToolset.Util.wixext ^
    -ext WixToolset.UI.wixext ^
    -out WhiteBeardPawnPlugin.msi

REM Done!
```

---

## ✅ STEP 5: Verify the Build

### Check if MSI was created:

```cmd
dir WhiteBeardPawnPlugin.msi
```

You should see the file with size > 1 MB

### Test the installer:

```cmd
REM Install with verbose logging
msiexec /i WhiteBeardPawnPlugin.msi /l*v install.log

REM After testing, uninstall
msiexec /x WhiteBeardPawnPlugin.msi
```

### Check the log:

```cmd
notepad install.log
```

Search for:
- "License verified successfully" ✅
- "MetaTrader 5 found" ✅
- Any "ERROR" messages ❌

---

## 📥 STEP 6: Download the MSI

After successful build, download the MSI to your Mac:

### Option A: SCP (from Mac)

```bash
# On Mac
scp user@windows-vps:/path/to/WhiteBeardPawnPluginInstaller/WhiteBeardPawnPlugin.msi ~/Downloads/
```

### Option B: Cloud Storage

On Windows:
1. Upload `WhiteBeardPawnPlugin.msi` to Dropbox/Google Drive
2. Download on Mac

### Option C: Direct Download

If Windows VPS has a web server:
1. Copy MSI to web directory
2. Download via browser

---

## 📋 Checklist: Files to Transfer to Windows

### ✅ Required Files:

```
WhiteBeardPawnPluginInstaller/
├── Files/
│   ├── PawnPlugin64.dll              ✅ MUST be real file
│   ├── LicenseAgreement.pdf          ✅ MUST be real file
│   ├── PawnPlugin_UserGuide.pdf      ✅ MUST be real file
│   └── (no .lic files needed)
├── CustomActions/
│   ├── *.cs                          ✅ All source files
│   └── CustomActions.csproj          ✅ Project file
├── UI/
│   └── *.wxs                         ✅ All dialog files
├── Product.wxs                       ✅ Main product file
├── PluginFiles.wxs                   ✅ Component file
├── PublicKey.xml                     ✅ Generated on Mac
├── icon.ico                          ✅ MUST be real icon
├── build.bat                         ✅ Build script
├── WhiteBeardPawnPlugin.sln          ✅ Solution file
└── WhiteBeardPawnPlugin.wixproj      ✅ Project file
```

### ❌ Do NOT Transfer:

```
❌ LicenseGenerator/PrivateKey.xml    (Keep SECRET on Mac!)
❌ LicenseGenerator/bin/               (Build artifacts)
❌ LicenseGenerator/obj/               (Build artifacts)
❌ CustomActions/bin/                  (Build artifacts)
❌ CustomActions/obj/                  (Build artifacts)
❌ Files/*.lic                         (License files - not needed)
❌ .git/                               (Git folder)
❌ *.msi                               (Old builds)
❌ *.wixpdb                            (Debug files)
```

---

## 🐛 Troubleshooting

### Error: "WiX not found"

```cmd
REM Check if WiX is installed
wix --version

REM If not found, reinstall WiX Toolset v4
REM Then restart command prompt
```

### Error: "dotnet not found"

```cmd
REM Check if .NET is installed
dotnet --version

REM If not found, install .NET SDK from Microsoft
```

### Error: "CustomActions.dll not found"

```cmd
REM Build CustomActions first
cd CustomActions
dotnet build -c Release
cd ..
```

### Error: "File not found: PawnPlugin64.dll"

```cmd
REM You forgot to replace placeholder files!
REM Copy real files to Files/ directory
```

### Error: "PublicKey.xml not found"

```cmd
REM PublicKey.xml must be in project root
dir PublicKey.xml

REM If missing, copy from Mac (it was generated by LicenseGenerator)
```

---

## 🎯 Quick Reference

### Complete Build Process:

```cmd
REM 1. Navigate to project
cd C:\WhiteBeardPawnPluginInstaller

REM 2. Build
build.bat

REM 3. Test
msiexec /i WhiteBeardPawnPlugin.msi /l*v install.log

REM 4. Verify
notepad install.log

REM 5. Uninstall
msiexec /x WhiteBeardPawnPlugin.msi
```

### Build Output Files:

```
WhiteBeardPawnPlugin.msi       ← This is what you distribute!
install.log                    ← Test installation log
CustomActions/bin/Release/     ← Built DLL
```

---

## 📤 After Building

1. **Sign the MSI** (recommended for production):
   ```cmd
   signtool sign /f YourCertificate.pfx /p password WhiteBeardPawnPlugin.msi
   ```

2. **Test on clean Windows VM** (highly recommended)

3. **Upload to your website** for distribution

4. **Update download links** in your documentation

---

## 🔄 Workflow Summary

```
┌──────────────────────────────────────────────────────────────┐
│ MAC                                                          │
├──────────────────────────────────────────────────────────────┤
│ 1. Develop code                                             │
│ 2. Generate licenses (with LicenseGenerator)               │
│ 3. Replace placeholder files with real files               │
│ 4. Transfer to Windows VPS                                 │
└──────────────────────────────────────────────────────────────┘
                         │
                         ↓
┌──────────────────────────────────────────────────────────────┐
│ WINDOWS VPS                                                  │
├──────────────────────────────────────────────────────────────┤
│ 1. Receive project files                                    │
│ 2. Install prerequisites (WiX, .NET)                        │
│ 3. Run: build.bat                                           │
│ 4. Test: msiexec /i WhiteBeardPawnPlugin.msi               │
│ 5. Download MSI back to Mac or upload to web server        │
└──────────────────────────────────────────────────────────────┘
                         │
                         ↓
┌──────────────────────────────────────────────────────────────┐
│ DISTRIBUTION                                                 │
├──────────────────────────────────────────────────────────────┤
│ 1. Upload MSI to website                                    │
│ 2. Customers download installer                             │
│ 3. Customers receive .lic files from you via email         │
│ 4. Customers install                                        │
└──────────────────────────────────────────────────────────────┘
```

---

## 💡 Pro Tips

1. **Use Git**: Easiest way to sync between Mac and Windows
2. **Keep PrivateKey.xml on Mac**: Never transfer to Windows
3. **Test in VM**: Always test on clean Windows before releasing
4. **Automate**: Set up CI/CD (GitHub Actions, Azure DevOps) for automated builds
5. **Version Control**: Tag releases in git (`git tag v1.0.0`)

---

## 🆘 Need Help?

If you encounter issues:

1. Check `install.log` for error messages
2. Verify all prerequisites are installed
3. Make sure placeholder files were replaced
4. Check `BUILD.md` for detailed troubleshooting
5. Review error messages in command prompt

---

## 🎉 Success!

When you see:
```
[5/5] Build complete!
========================================
Output: WhiteBeardPawnPlugin.msi
========================================
```

You're done! 🎊

The MSI is ready to distribute to customers.
